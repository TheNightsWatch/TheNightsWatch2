<?php
/** @var \NightsWatch\Entity\Event $event */
use \NightsWatch\Entity\User;

if (!isset($useEventLink)) {
    $useEventLink = true;
}
if (!isset($showRsvp)) {
    $showRsvp = false;
}
$eventUrl = $this->url('id', ['controller' => 'event', 'action' => 'view', 'id' => $event->id]);
$iso8601 = $event->start->format(DateTime::ISO8601);
?>
<article class="event span6 offset4">
    <header>
        <time class="time" datetime="<?= $iso8601; ?>" title="<?= $iso8601 ?>">
            <span class="dateformat" data-format="H:i" data-unix="<?= $event->start->getTimestamp(); ?>">
                <?= $event->start->format('H:i T'); ?>
            </span>
            <span class="date dateformat" data-format="M j" data-unix="<?= $event->start->getTimestamp(); ?>">
                <?= $event->start->format('M j'); ?>
            </span>
        </time>
        <h2>
            <?= $useEventLink ? "<a href=\"{$eventUrl}\">" : null ?>
            <?= htmlspecialchars($event->name); ?>
            <?= $useEventLink ? '</a>' : null ?>
        </h2>
    </header>
    <?php if ($event->lowestViewableRank > User::RANK_CIVILIAN): ?>
        <p class="alert alert-error fade in">
            <a href="#" class="close" data-dismiss="alert">&times;</a>
            This event is classified. All information concerning it is classified and only available to members of
            rank <?= User::getRankName($event->lowestViewableRank); ?> and up.
        </p>
    <?php endif; ?>
    <div class="well well-small">
        <?= $event->getParsedDescription(); ?>
    </div>
    <footer>
        posted by <a rel="author"><?= htmlspecialchars($event->user->getTitleWithName()) ?></a>
        <br /><br />
        <?php
        if ($showRsvp) {
            $form = new \NightsWatch\Form\RsvpForm($event);
            echo $this->bootstrapForm($form);
        }
        ?>
    </footer>
</article>
